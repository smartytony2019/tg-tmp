(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{780:function(t,e,r){"use strict";r.r(e);r(15),r(11),r(10),r(9),r(8),r(13),r(33);var n=r(5),o=r(7),l=r(0),c=r.n(l),header=r(101),d=(r(43),r(66),r(24),r(42)),v=(r(289),r(769),r(771)),f=r.n(v),h={props:{trigger:{type:[String,Element],required:!0},uploadHandler:{type:Function,default:function(){}},uploadUrl:{type:String,default:""},requestMethod:{type:String,default:"POST"},uploadHeaders:{type:Object,default:function(){return{}}},uploadFormName:{type:String,default:"file"},uploadFormData:{type:Object,default:function(){return{}}},cropperOptions:{type:Object,default:function(){return{aspectRatio:1,autoCropArea:1,viewMode:1,movable:!1,zoomable:!1}}},outputOptions:{type:Object,default:function(){return{}}},outputMime:{type:String,default:null},outputQuality:{type:Number,default:.9},mimes:{type:String,default:"image/png, image/jpeg"},labels:{type:Object,default:function(){return{submit:"确定",cancel:"取消"}}},withCredentials:{type:Boolean,default:!1}},data:function(){return{cropper:void 0,dataUrl:void 0,filename:void 0}},mounted:function(){var t=this,e="object"===Object(d.a)(this.trigger)?this.trigger:document.querySelector(this.trigger);e?e.addEventListener("click",this.pickImage):this.$emit("error","No avatar make trigger found.","user");var r=this.$refs.input;r.addEventListener("change",(function(){if(null!=r.files&&null!=r.files[0]){var e=new FileReader;e.onload=function(e){t.dataUrl=e.target.result},e.readAsDataURL(r.files[0]),t.filename=r.files[0].name||"unknown",t.mimeType=t.mimeType||r.files[0].type,t.$emit("changed",r.files[0],e)}}))},methods:{destroy:function(){this.cropper.destroy(),this.$refs.input.value="",this.dataUrl=void 0},submit:function(){this.$emit("submit"),this.uploadUrl?this.uploadImage():this.uploadHandler?this.uploadHandler(this.cropper):this.$emit("error","No upload handler found.","user"),this.destroy()},pickImage:function(t){this.$refs.input&&this.$refs.input.click(),t.preventDefault(),t.stopPropagation()},createCropper:function(){this.cropper=new f.a(this.$refs.img,this.cropperOptions)},uploadImage:function(){var t=this;this.cropper.getCroppedCanvas(this.outputOptions).toBlob((function(e){var form=new FormData,r=new XMLHttpRequest,data=Object.assign({},t.uploadFormData);for(var n in r.withCredentials=t.withCredentials,data)form.append(n,data[n]);for(var header in form.append(t.uploadFormName,e,t.filename),t.$emit("uploading",form,r),r.open(t.requestMethod,t.uploadUrl,!0),t.uploadHeaders)r.setRequestHeader(header,t.uploadHeaders[header]);r.onreadystatechange=function(){if(4===r.readyState){var e="";try{e=JSON.parse(r.responseText)}catch(t){e=r.responseText}t.$emit("completed",e,form,r),[200,201,204].includes(r.status)?t.$emit("uploaded",e,form,r):t.$emit("error","Image upload fail.","upload",r)}},r.send(form)}),this.outputMime,this.outputQuality)}}},m=r(2),_=Object(m.a)(h,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"avatar-cropper"},[t.dataUrl?r("div",{staticClass:"avatar-cropper-overlay"},[r("div",{staticClass:"avatar-cropper-container"},[r("div",{staticClass:"avatar-cropper-image-container"},[r("img",{ref:"img",attrs:{src:t.dataUrl,alt:""},on:{load:function(e){return e.stopPropagation(),t.createCropper(e)}}})]),t._v(" "),r("div",{staticClass:"avatar-cropper-footer"},[r("button",{staticClass:"avatar-cropper-btn",domProps:{textContent:t._s(t.labels.cancel)},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.destroy(e)}}},[t._v("Cancel")]),t._v(" "),r("button",{staticClass:"avatar-cropper-btn btn-submit",domProps:{textContent:t._s(t.labels.submit)},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.submit(e)}}},[t._v("Submit")])])])]):t._e(),t._v(" "),r("input",{ref:"input",staticClass:"avatar-cropper-img-input",attrs:{accept:t.mimes,type:"file"}})])}),[],!1,null,null,null).exports;function y(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function P(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?y(Object(source),!0).forEach((function(e){Object(n.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):y(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var w={layout:"member",transition:"rightIn",components:{AppHeader:header.a,AvatarCropper:_},data:function(){return{editAvatar:!1,selectedPhoto:{},setting_title:"",defaultAvatarPhotos:[],timestamp:"",userAvatar:void 0}},computed:P({},Object(o.c)("my",["memberInfo","preIconList"])),watch:{preIconList:function(t){this.timestamp=c()().format("x"),this.defaultAvatarPhotos=JSON.parse(JSON.stringify(t))}},created:function(){this.getMemberInfo(),this.getPreIconUrl()},methods:P(P({},Object(o.b)("my",["getMemberInfo","getPreIconUrl","updateMemberProfile","uploadsMyIcon","changeLevelView"])),{},{changeHandler:function(t){this.changeLevelView({status:1==t.target.checked?1:0})},editAvatarBtnClick:function(){this.editAvatar=!0,this.setting_title="头像更换",this.getPreIconUrl()},selectedAvatar:function(t){for(var e in this.selectedPhoto=t,this.defaultAvatarPhotos)this.defaultAvatarPhotos[e].profile_status=this.defaultAvatarPhotos[e]==t?"1":"0";this.selectedPhoto.data?this.uploadsMyIcon({img:this.selectedPhoto.data}):this.updateMemberProfile({file_url:this.selectedPhoto.url}),this.cancel()},previewFiles:function(t){this.showPreviewImage(t.getCroppedCanvas({width:256,height:256}).toDataURL("image/png")),t.destroy()},showPreviewImage:function(t){var e=this.defaultAvatarPhotos[6]?this.defaultAvatarPhotos[6].profile_status:"0";this.$set(this.defaultAvatarPhotos,"6",{url:t,profile_status:e,data:t.replace("data:image/png;base64,","")})},cancel:function(){this.editAvatar=!1,this.getPreIconUrl()},submit:function(){this.editAvatar&&(this.updateMemberProfile({file_url:this.selectedPhoto.url}),this.cancel())},goBack:function(){this.$router.push("/my")}})},C=Object(m.a)(w,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"page-container"},[r("app-header",{attrs:{title:"个人资料","back-enable":!0,"header-class":"header_white",desc:"my4",guide:"profile"}}),t._v(" "),r("main",[r("ul",{staticClass:"myprofile"},[r("li",[r("span",[t._v("会员ID")]),t._v(" "),r("div",[t._v(t._s(t.memberInfo.account))])]),t._v(" "),r("li",[r("span",[t._v("微信号")]),t._v(" "),r("div",[t._v(t._s(t.memberInfo.wechat))])]),t._v(" "),r("li",[r("span",[t._v("头像更换")]),t._v(" "),r("div",[t._v("\n          1MB以内\n          "),r("button",{staticClass:"edit_btn",on:{click:t.editAvatarBtnClick}})])])]),t._v(" "),r("ul",{staticClass:"myprofile"},[t._m(0),t._v(" "),r("li",[r("span",[t._v("等级显示")]),t._v(" "),r("div",[r("input",{attrs:{id:"show_lv",type:"checkbox",name:"show_lv"},domProps:{checked:t.memberInfo.levelDisplay},on:{click:t.changeHandler}}),t._v(" "),t._m(1)])])])]),t._v(" "),r("div",{staticClass:"seting",class:{active:t.editAvatar}},[r("div",{staticClass:"seting_panel"},[r("div",{staticClass:"seting_title"},[r("button",{staticClass:"cancel_btn",on:{click:t.cancel}},[t._v("取消")]),t._v(" "),r("span",[t._v(t._s(t.setting_title))])]),t._v(" "),r("div",{staticClass:"seting_box"},[r("ul",{directives:[{name:"show",rawName:"v-show",value:t.editAvatar,expression:"editAvatar"}],staticClass:"head_shot"},[t._l(t.defaultAvatarPhotos,(function(e,n){return r("li",{key:n,class:{selected:"1"==e.profile_status},on:{click:function(r){return t.selectedAvatar(e)}}},[r("div",{staticClass:"photo"},[r("img",{attrs:{src:e.url+(e.data?"":"?"+t.timestamp)}})])])})),t._v(" "),t._m(2)],2),t._v(" "),r("avatar-cropper",{attrs:{trigger:"#pick-avatar","upload-handler":t.previewFiles}})],1)]),t._v(" "),r("div",{staticClass:"overlay",on:{click:t.cancel}})])],1)}),[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("li",[r("span",[t._v("主题背景")]),t._v(" "),r("div",[t._v("\n          预设\n          "),r("button",{staticClass:"edit_btn"})])])},function(){var t=this.$createElement,e=this._self._c||t;return e("label",{attrs:{for:"show_lv"}},[e("span")])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("li",{attrs:{id:"pick-avatar"}},[r("label",{staticClass:"upload_btn"},[r("span",[t._v("自订")]),t._v(" "),r("b",[t._v("1MB以内")])])])}],!1,null,null,null);e.default=C.exports}}]);